{{/*
  Datacenter Providers list
  Usage: {{< datacenter-providers >}}

  Renders provider cards linking to /datacenters/{provider_id}/
*/}}

{{ $datacenters := site.Data.datacenters }}
{{ $regions := site.Data.regions }}

{{/* Build regions lookup by id */}}
{{ $regionsById := dict }}
{{ range $regions }}
  {{ $regionsById = merge $regionsById (dict .id .) }}
{{ end }}

{{ $providers := $datacenters.providers | default (slice) }}

{{/* Compact chip-style list to avoid taking too much vertical space */}}
<div class="mt-3 flex flex-wrap gap-2">
  {{ range $providers }}
    {{ $vendor := index $regionsById .vendor_country_id }}
    {{ $flag := "" }}
    {{ $vendorName := .vendor_country_id }}
    {{ $risk := "unknown" }}
    {{ if $vendor }}
      {{ $flag = $vendor.flag }}
      {{ $vendorName = $vendor.name }}
      {{ $risk = $vendor.risk_level }}
    {{ end }}

    {{/* small colored dot by risk */}}
    {{ $dot := "bg-neutral-400" }}
    {{ if eq $risk "low" }}{{ $dot = "bg-green-500" }}{{ end }}
    {{ if eq $risk "moderate" }}{{ $dot = "bg-yellow-500" }}{{ end }}
    {{ if eq $risk "elevated" }}{{ $dot = "bg-orange-500" }}{{ end }}
    {{ if eq $risk "high" }}{{ $dot = "bg-red-500" }}{{ end }}
    {{ if eq $risk "sanctioned" }}{{ $dot = "bg-red-700" }}{{ end }}

    <a class="inline-flex items-center gap-2 no-underline px-3 py-1 rounded-full border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 hover:border-primary-400 dark:hover:border-primary-500 transition-colors text-sm"
       href="/datacenters/{{ .provider_id }}/"
       title="HQ: {{ $vendorName }} ({{ .vendor_country_id }}) • Risk: {{ $risk }} • Regions: {{ len (.regions | default (slice)) }}">
      <span class="inline-block w-2 h-2 rounded-full {{ $dot }}"></span>
      <span class="font-medium">{{ .provider_name }}</span>
      <span class="text-neutral-500 dark:text-neutral-400">
        {{ if $flag }}{{ $flag }}{{ end }} {{ len (.regions | default (slice)) }}
      </span>
    </a>
  {{ end }}
</div>


