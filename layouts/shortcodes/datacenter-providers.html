{{/*
Datacenter Providers list
Usage: {{< datacenter-providers >}}

Renders provider cards linking to /datacenters/{provider_id}/
*/}}

{{ $providers := site.Data.datacenters.providers | default (slice) }}

{{/* Group providers by provider_type */}}
{{ $groups := slice
  (dict "key" "hyperscaler" "title" "Hyperscalers")
  (dict "key" "regional_cloud" "title" "Regional cloud providers")
  (dict "key" "datacenter_operator" "title" "Datacenter operators")
}}

{{ range $groups }}
  {{ $key := .key }}
  {{ $title := .title }}
  {{ $items := where $providers "provider_type" $key }}
  {{ $items = sort $items "provider_id" "asc" }}
  {{ $items = sort $items "provider_name" "asc" }}

  {{ if gt (len $items) 0 }}
  <h3 class="mt-6 mb-2 text-sm font-semibold text-neutral-700 dark:text-neutral-200">{{ $title }}</h3>
  <div class="flex flex-wrap gap-2">
    {{ range $items }}
      {{ $region := partial "get-region-by-id.html" .vendor_country_id }}
      {{ $flag := $region.flag | default "" }}
      {{ $vendorName := $region.name | default .vendor_country_id }}
      {{ $risk := $region.riskLevel | default "unknown" }}
      {{ $regionCount := len (.regions | default (slice)) }}

      {{ partial "chip-link.html" (dict
        "href" (printf "/datacenters/%s/" .provider_id)
        "title" (printf "Type: %s • HQ: %s (%s) • Risk: %s • Regions: %d" .provider_type $vendorName .vendor_country_id $risk $regionCount)
        "risk" $risk
        "label" .provider_name
        "meta" (string $regionCount)
        "flag" $flag
      ) }}
    {{ end }}
  </div>
  {{ end }}
{{ end }}
