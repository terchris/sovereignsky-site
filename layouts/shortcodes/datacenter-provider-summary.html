{{/*
  Provider summary box for datacenter provider pages.
  Usage: {{< datacenter-provider-summary >}}
  Requires page param: provider_id
*/}}

{{ $providerId := .Page.Params.provider_id | default "" }}
{{ $providers := site.Data.datacenters.providers | default (slice) }}
{{ $provider := dict }}
{{ range $providers }}
  {{ if eq .provider_id $providerId }}
    {{ $provider = . }}
  {{ end }}
{{ end }}

{{ $regionsById := dict }}
{{ range (site.Data.regions | default (slice)) }}
  {{ $regionsById = merge $regionsById (dict .id .) }}
{{ end }}

{{ $hqId := "" }}
{{ $hq := dict }}
{{ $hqName := "" }}
{{ $hqFlag := "" }}
{{ $hqRisk := "unknown" }}
{{ $hqSlug := "" }}
{{ if $provider }}
  {{ $hqId = $provider.vendor_country_id | default "" }}
{{ end }}
{{ if $hqId }}
  {{ $hq = index $regionsById $hqId }}
  {{ if $hq }}
    {{ $hqName = $hq.name }}
    {{ $hqFlag = $hq.flag }}
    {{ $hqRisk = $hq.risk_level }}
    {{ $hqSlug = $hq.slug }}
  {{ end }}
{{ end }}

{{/* risk dot */}}
{{ $dot := "bg-neutral-400" }}
{{ if eq $hqRisk "low" }}{{ $dot = "bg-green-500" }}{{ end }}
{{ if eq $hqRisk "moderate" }}{{ $dot = "bg-yellow-500" }}{{ end }}
{{ if eq $hqRisk "elevated" }}{{ $dot = "bg-orange-500" }}{{ end }}
{{ if eq $hqRisk "high" }}{{ $dot = "bg-red-500" }}{{ end }}
{{ if eq $hqRisk "sanctioned" }}{{ $dot = "bg-red-700" }}{{ end }}

{{ if $provider }}
<div class="not-prose mt-3 max-w-prose rounded-xl border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 p-4">
  <div class="flex flex-wrap items-center gap-3">
    <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 text-sm">
      <span class="inline-block w-2 h-2 rounded-full {{ $dot }}"></span>
      <span class="font-medium">HQ</span>
      <span class="text-neutral-500 dark:text-neutral-400">
        {{ if $hqFlag }}{{ $hqFlag }}{{ end }} {{ $hqName | default $hqId }}
      </span>
    </span>

    <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 text-sm">
      <span class="font-medium">Regions</span>
      <span class="text-neutral-500 dark:text-neutral-400">{{ len ($provider.regions | default (slice)) }}</span>
    </span>

    {{ if $provider.updated }}
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 text-sm">
        <span class="font-medium">Last updated</span>
        <span class="text-neutral-500 dark:text-neutral-400">{{ $provider.updated }}</span>
      </span>
    {{ end }}

    {{ if $provider.vendor_website }}
      <a class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 hover:border-primary-400 dark:hover:border-primary-500 transition-colors text-sm no-underline"
         href="{{ $provider.vendor_website }}">
        <span class="font-medium">Official site</span>
        <span class="text-neutral-500 dark:text-neutral-400">â†—</span>
      </a>
    {{ end }}

    {{ if and $hqSlug (ne $hqSlug "") }}
      <a class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 hover:border-primary-400 dark:hover:border-primary-500 transition-colors text-sm no-underline"
         href="/laws/{{ $hqSlug }}/">
        <span class="font-medium">Laws</span>
        <span class="text-neutral-500 dark:text-neutral-400">{{ if $hqFlag }}{{ $hqFlag }}{{ end }} {{ $hqName | default $hqId }}</span>
      </a>
    {{ end }}
  </div>
</div>
{{ end }}


