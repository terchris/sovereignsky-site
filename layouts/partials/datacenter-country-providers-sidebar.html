{{/*
Datacenter Country Providers Sidebar
Usage: {{ partial "datacenter-country-providers-sidebar.html" (dict "providerItems" $providerItems "countryName" $countryName "countryFlag" $countryFlag) }}

Renders a sidebar list of providers with region counts for a specific country.
*/}}

{{ $providerItems := .providerItems | default (slice) }}
{{ $countryName := .countryName | default "" }}
{{ $countryFlag := .countryFlag | default "" }}

{{ if gt (len $providerItems) 0 }}
<div class="mt-6">
  <div class="text-lg font-semibold text-neutral-800 dark:text-neutral-100">Providers</div>
  <div class="text-sm text-neutral-500 dark:text-neutral-400">{{ len $providerItems }} providers in {{ if $countryFlag }}{{ $countryFlag }} {{ end }}{{ $countryName }}</div>
  <div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <ul class="m-0 p-0 list-none space-y-1">
      {{ range $providerItems }}
        {{ $p := .provider }}
        {{ $count := .count }}
        {{/* Look up provider's vendor country for flag */}}
        {{ $providerFlag := "" }}
        {{ $vendorCountryId := $p.vendor_country_id | default "" }}
        {{ if $vendorCountryId }}
          {{ $vendorMatch := first 1 (where site.Data.regions "id" $vendorCountryId) }}
          {{ with index $vendorMatch 0 }}
            {{ $providerFlag = .flag | default "" }}
          {{ end }}
        {{ end }}
        <li class="m-0 p-0">
          {{ if $providerFlag }}<span class="mr-1">{{ $providerFlag }}</span>{{ end -}}
          <a class="no-underline hover:underline"
             href="/datacenters/{{ $p.provider_id }}/"
             title="View {{ $p.provider_name }} datacenters">
            {{ $p.provider_name }}
          </a>
          <span class="text-neutral-500 dark:text-neutral-400">({{ $count }})</span>
        </li>
      {{ end }}
    </ul>
  </div>
</div>
{{ end }}
