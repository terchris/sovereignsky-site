{{/*
Datacenter Country Providers Sidebar
Usage: {{ partial "datacenter-country-providers-sidebar.html" (dict "providerItems" $providerItems "countryName" $countryName "countryFlag" $countryFlag) }}

Renders a card with a list of providers with region counts for a specific country.
*/}}

{{ $providerItems := .providerItems | default (slice) }}
{{ $countryName := .countryName | default "" }}
{{ $countryFlag := .countryFlag | default "" }}

{{ if gt (len $providerItems) 0 }}
<div class="card bg-base-100 shadow-sm border border-base-300">
  <div class="card-body p-4">
    <h3 class="card-title text-sm font-semibold flex items-center gap-2">
      {{ partial "icon.html" (dict "name" "server" "color" "primary" "size" "4") }}
      Providers
    </h3>
    <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-2">
      {{ len $providerItems }} providers in {{ if $countryFlag }}{{ $countryFlag }} {{ end }}{{ $countryName }}
    </div>
    <ul class="space-y-0.5 max-h-48 overflow-y-auto">
      {{ range $providerItems }}
        {{ $p := .provider }}
        {{ $count := .count }}
        {{/* Look up provider's vendor country for flag */}}
        {{ $providerFlag := "" }}
        {{ $vendorCountryId := $p.vendorCountryId | default "" }}
        {{ if $vendorCountryId }}
          {{ $vendorMatch := first 1 (where site.Data.countries.countries.itemListElement "identifier" $vendorCountryId) }}
          {{ with index $vendorMatch 0 }}
            {{ $providerFlag = .flag | default "" }}
          {{ end }}
        {{ end }}
      <li>
        <a href="/datacenters/{{ $p.identifier }}/"
           title="{{ $p.name }}: {{ $count }} regions"
           class="text-sm block px-2 py-1 -mx-2 rounded hover:bg-base-200 dark:hover:bg-neutral-800 no-underline flex justify-between items-center">
          <span>{{ if $providerFlag }}{{ $providerFlag }} {{ end }}{{ $p.name }}</span>
          <span class="text-neutral-500 dark:text-neutral-400">{{ $count }}</span>
        </a>
      </li>
      {{ end }}
    </ul>
  </div>
</div>
{{ end }}
