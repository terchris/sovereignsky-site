{{/*
persona-chips.html
Shows persona chips for a page, linking to /personas/#<termCode>.

    Rules:
    - Prefer explicit front matter: personas: ["developer", ...]
    - Fallback to audiences: ["developers","public-sector",...]
    */}}

    {{ $page := . }}
    {{ $personas := slice }}

    {{/* Prefer explicit */}}
    {{ with $page.Params.personas }}
    {{ $personas = . | default (slice) }}
    {{ end }}

    {{/* Fallback mapping from blog "audience" values to persona termCodes */}}
    {{ if eq (len $personas) 0 }}
    {{ $audToPersona := dict
    "developer" "developer"
    "developers" "developer"
    "technical" "technical"
    "it-operations" "technical"
    "enterprise" "enterprise"
    "public-sector" "government"
    "government" "government"
    "humanitarian" "humanitarian"
    "defence" "defence"
    "defense" "defence"
    }}

    {{ $derived := slice }}
    {{ range ($page.Params.audience | default (slice)) }}
    {{ $mapped := index $audToPersona . }}
    {{ if $mapped }}
    {{ if not (in $derived $mapped) }}
    {{ $derived = $derived | append $mapped }}
    {{ end }}
    {{ end }}
    {{ end }}
    {{ $personas = $derived }}
    {{ end }}

    {{ if gt (len $personas) 0 }}
    {{/* Build labels from audience.json */}}
    {{ $labels := dict }}
    {{ range site.Data.audience.audience.itemListElement }}
      {{ $labels = merge $labels (dict .identifier .name) }}
    {{ end }}

    <div class="mt-6">
        <div class="text-lg font-semibold text-neutral-800 dark:text-neutral-100">Personas</div>
        <div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
            <div class="flex flex-wrap gap-2">
                {{ range $personas }}
                {{ $code := . }}
                {{ $label := index $labels $code | default ($code | humanize | title) }}
                <a href="/personas/#{{ $code }}"
                    class="inline-flex items-center gap-1 no-underline px-2 py-0.5 rounded-full border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 hover:border-primary-400 dark:hover:border-primary-500 transition-colors text-xs">
                    {{ $label }}
                </a>
                {{ end }}
            </div>
        </div>
    </div>
    {{ end }}