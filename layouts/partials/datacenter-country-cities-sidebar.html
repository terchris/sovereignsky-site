{{/*
Datacenter Country Cities Sidebar
Usage: {{ partial "datacenter-country-cities-sidebar.html" (dict "countryId" $countryId "countryName" $countryName "countryFlag" $countryFlag "providers" $providers) }}

Renders a card with a list of cities with region counts for a specific country.
*/}}

{{ $countryId := .countryId | default "" }}
{{ $countryName := .countryName | default "" }}
{{ $countryFlag := .countryFlag | default "" }}
{{ $providers := .providers | default (slice) }}

{{ if $countryId }}
  {{/* Build city counts */}}
  {{ $cityRegionCounts := dict }}
  {{ $cityOrder := slice }}
  {{ range $providers }}
    {{ range (.regions | default (slice)) }}
      {{ if eq .countryId $countryId }}
        {{ $city := .city | default "Unknown" }}
        {{ $existing := index $cityRegionCounts $city | default 0 }}
        {{ $cityRegionCounts = merge $cityRegionCounts (dict $city (add $existing 1)) }}
        {{ if not (in $cityOrder $city) }}
          {{ $cityOrder = $cityOrder | append $city }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{/* Sort by count descending */}}
  {{ $cityItems := slice }}
  {{ range $cityOrder }}
    {{ $city := . }}
    {{ $count := index $cityRegionCounts $city }}
    {{ $cityItems = $cityItems | append (dict "city" $city "count" $count) }}
  {{ end }}
  {{ $cityItems = sort $cityItems "count" "desc" }}

  {{ if gt (len $cityItems) 0 }}
<div class="card bg-base-100 shadow-sm border border-base-300">
  <div class="card-body p-4">
    <h3 class="card-title text-sm font-semibold flex items-center gap-2">
      {{ partial "content-icon.html" (dict "name" "building" "color" "accent" "size" "4") }}
      Cities
    </h3>
    <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-2">
      {{ len $cityItems }} cities in {{ if $countryFlag }}{{ $countryFlag }} {{ end }}{{ $countryName }}
    </div>
    <ul class="space-y-0.5 max-h-48 overflow-y-auto">
      {{ range $cityItems }}
      <li>
        <span class="text-sm block px-2 py-1 -mx-2 flex justify-between items-center">
          <span>{{ .city }}</span>
          <span class="text-neutral-500 dark:text-neutral-400">{{ .count }}</span>
        </span>
      </li>
      {{ end }}
    </ul>
  </div>
</div>
  {{ end }}
{{ end }}
