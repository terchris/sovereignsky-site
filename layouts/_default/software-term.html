{{ define "main" }}
<div class="max-w-6xl mx-auto">

  <header class="mb-8">
    <nav class="text-sm mb-2">
      <a href="/software/" class="text-primary-600 dark:text-primary-400 hover:underline">Software Database</a>
      <span class="text-neutral-400 mx-2">â€º</span>
      <span class="text-neutral-600 dark:text-neutral-300">{{ .Title }}</span>
    </nav>
    <h1 class="text-3xl font-bold mb-4">{{ .Title }}</h1>
    <p class="text-lg text-neutral-600 dark:text-neutral-300">
      {{ len .Pages }} products with this filter
    </p>
  </header>

  <!-- Filter Navigation -->
  <div class="mb-8 p-4 bg-neutral-50 dark:bg-neutral-800 rounded-lg">

    <!-- Risk Level Filter -->
    <div class="mb-4">
      <span class="text-sm font-medium text-neutral-700 dark:text-neutral-300 mr-2">Risk Level:</span>
      <div class="inline-flex flex-wrap gap-2 mt-2">
        <a href="/software/" class="filter-link">All</a>
        {{ range $term, $pages := site.Taxonomies.risk_levels }}
        <a href="/risk_levels/{{ $term | urlize }}/" class="filter-link {{ if eq $.Data.Singular "risk_level" }}{{ if eq $.Title ($term | title) }}active{{ end }}{{ end }}">
          {{ $term | title }}
          <span class="text-xs opacity-70">({{ len $pages }})</span>
        </a>
        {{ end }}
      </div>
    </div>

    <!-- Country Filter -->
    <div class="mb-4">
      <span class="text-sm font-medium text-neutral-700 dark:text-neutral-300 mr-2">Vendor Country:</span>
      <div class="inline-flex flex-wrap gap-2 mt-2">
        <a href="/software/" class="filter-link">All</a>
        {{ range $term, $pages := site.Taxonomies.vendor_countries }}
        <a href="/vendor_countries/{{ $term | urlize }}/" class="filter-link {{ if eq $.Data.Singular "vendor_country" }}{{ if eq $.Title $term }}active{{ end }}{{ end }}">
          {{ if eq $term "US" }}USA{{ else if eq $term "NO" }}Norway{{ else if eq $term "EU" }}EU{{ else }}{{ $term }}{{ end }}
          <span class="text-xs opacity-70">({{ len $pages }})</span>
        </a>
        {{ end }}
      </div>
    </div>

    <!-- Use Area Filter -->
    <div>
      <span class="text-sm font-medium text-neutral-700 dark:text-neutral-300 mr-2">Use Area:</span>
      <div class="inline-flex flex-wrap gap-2 mt-2">
        <a href="/software/" class="filter-link">All</a>
        {{ range $term, $pages := site.Taxonomies.use_areas }}
        {{ $area := index (where site.Data.software.use_areas "id" $term) 0 }}
        {{ $displayName := $term | title }}
        {{ if $area }}{{ $displayName = $area.name }}{{ end }}
        <a href="/use_areas/{{ $term | urlize }}/" class="filter-link {{ if eq $.Data.Singular "use_area" }}{{ if eq $.Title $displayName }}active{{ end }}{{ end }}">
          {{ $displayName }}
          <span class="text-xs opacity-70">({{ len $pages }})</span>
        </a>
        {{ end }}
      </div>
    </div>

  </div>

  <!-- Results count -->
  <div class="mb-4 text-sm text-neutral-600 dark:text-neutral-400">
    Showing {{ len .Pages }} products
  </div>

  <!-- Product Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {{ range .Pages }}
    {{ $product := index (where site.Data.software.products "id" .Params.software_id) 0 }}
    {{ if $product }}
    <article class="border border-neutral-200 dark:border-neutral-700 rounded-lg p-4 hover:border-primary-500 transition-colors bg-white dark:bg-neutral-900">
      <a href="{{ .RelPermalink }}" class="block">
        <!-- Header -->
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            {{ partial "country-flag" $product.vendor.country }}
            <span class="text-xs text-neutral-500 dark:text-neutral-400">{{ $product.vendor.name }}</span>
          </div>
          {{ if $product.sovereignty.cloud_act }}
          <span class="bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-xs px-2 py-0.5 rounded">CLOUD Act</span>
          {{ end }}
        </div>

        <!-- Name -->
        <h2 class="text-lg font-semibold mb-2">{{ $product.name }}</h2>

        <!-- Description -->
        <p class="text-sm text-neutral-600 dark:text-neutral-400 mb-3 line-clamp-2">{{ $product.description }}</p>

        <!-- Score badge -->
        {{ partial "sovereignty-badge" $product.sovereignty }}

        <!-- Use areas -->
        <div class="mt-3 flex flex-wrap gap-1">
          {{ range $product.use_areas }}
          {{ $area := index (where site.Data.software.use_areas "id" .) 0 }}
          {{ if $area }}
          <span class="text-xs bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400 px-2 py-0.5 rounded">
            {{ $area.name }}
          </span>
          {{ end }}
          {{ end }}
        </div>
      </a>
    </article>
    {{ end }}
    {{ end }}
  </div>

  {{ if eq (len .Pages) 0 }}
  <div class="text-center py-8 text-neutral-500 dark:text-neutral-400">
    No software matches this filter.
  </div>
  {{ end }}

</div>

<style>
.filter-link {
  padding: 0.25rem 0.75rem;
  font-size: 0.875rem;
  border-radius: 9999px;
  border: 1px solid rgb(212, 212, 212);
  background-color: white;
  color: rgb(64, 64, 64);
  transition: all 0.15s ease;
  text-decoration: none;
  display: inline-block;
}
.dark .filter-link {
  border-color: rgb(82, 82, 82);
  background-color: rgb(23, 23, 23);
  color: rgb(212, 212, 212);
}
.filter-link:hover {
  border-color: rgb(var(--color-primary-500));
  color: rgb(var(--color-primary-600));
}
.dark .filter-link:hover {
  color: rgb(var(--color-primary-400));
}
.filter-link.active {
  background-color: rgb(var(--color-primary-500));
  border-color: rgb(var(--color-primary-500));
  color: white;
}
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>
{{ end }}
